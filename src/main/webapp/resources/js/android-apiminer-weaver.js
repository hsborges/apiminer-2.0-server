/**
 *  APIMiner JavaDoc Weaver - JavaDoc documentation generated by javadoc command
 *  
 *  	This script instruments automatically the JavaDoc documentation. 
 *  Basically, it adds the "Example" button in the list of public methods.
 *  
 */

/**
 * Main method.
 */
function instruments() {
	console.log("Loading: " + apiminer_server_url + '/resources/apiminer-header.html');
	$('.apiminerHeaderDiv').load(apiminer_server_url + '/resources/apiminer-header.html');
	
	console.log("Instrumenting documentation");
	
	var apiClass = $("table.jd-inheritance-table td.jd-inheritance-class-cell").last().text();
	console.log("API Class: " + apiClass);
	
	if (apiClass == null || apiClass == '' || apiClass.indexOf("android") != 0) return;
	
	$("#pubmethods tr, #pubctors tr, #promethods tr").each(function(){
		if ($(this).hasClass("api")) {
			var ebtn = $("<button></button>")
				.addClass("ui-button ui-state-default ui-corner-all ui-button-text-only ui-state-focus")
				.attr("role", "button")
				.attr("aria-disabled", "false")
				.attr("style","height: 2.1em; width: 5.5em;")
				.text("Example");
			
			var espan = $("<span>? Examples</span>");
			
			$(this).prepend($("<td></td>")
					.attr("class","jd-typecol")
					.attr("style","text-align:center; min-width:7em;")
					.append(ebtn)
					.append("<br/>")
					.append(espan));
		}
	});
	
	jQuery.get(
			examples_counter_url,
			{apiClass: apiClass},
			function(data) {
				var obj = jQuery.parseJSON(data);
				
				$("#pubmethods tr, #pubctors tr, #promethods tr").each(function(){
					if ($(this).hasClass("api")) {
						var methodName = $(this).find($("td.jd-linkcol a"))
							.first()
							.attr("href")
							.replace("/reference/","/")
							.replace(/\.\.\//g, "")
							.replace(".html#","/")
							.replace(/\//g, ".");
						
						var method_data = obj.methods[methodName];
						
						var ebtn = $("<button></button>")
							.addClass("ui-button ui-state-default ui-corner-all ui-button-text-only ui-state-focus")
							.attr("role", "button")
							.attr("aria-disabled", "false")
							.attr("style","height: 2.1em; width: 5.5em;")
							.text("Example");
						var espan = $("<span></span>");
						
						var num_examples = 0;
						if (method_data != null) {
							num_examples = method_data.num_examples;
						}
						
						if (num_examples != 0) {
							ebtn.click(function() {
								$("span.ui-dialog-title").text(methodName); 
								populate(method_data.method_id, 0, null);
								btnClick(method_data.method_id);
							});
						}
						
						$(this).find("td").first().remove();
						
						$(this).prepend($("<td></td>")
								.attr("class","jd-typecol")
								.attr("style","text-align:center; min-width:7em;")
								.append(ebtn)
								.append("<br/>")
								.append(espan));
						
						espan.text(num_examples + " Examples");
					}
				});
			}
	);
	
}